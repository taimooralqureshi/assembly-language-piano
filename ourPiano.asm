.MODEL SMALL


.STACK 100H
;###############################################################################
;############################### MACRO DEFINE ##################################
;###############################################################################

;----------------------------------------------------------------------------------
;<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<  SPEAKER OFF  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
;----------------------------------------------------------------------------------

COMMAND_SPEAKER_OFF MACRO
		
	IN AL,PORTB   			;	 SPEAKER TURN ON VIA INT 61H
	AND AL,11111100B
	OUT PORTB,AL
	JMP KEYINPUT			;    JUMP TO BEGINING 

ENDM

;----------------------------------------------------------------------------------
;<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<  SPEAKER ON  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
;----------------------------------------------------------------------------------

COMMAND_SPEAKER_ON MACRO
		
	IN AL,PORTB			    ;    SPEAKER TURN ON VIA INT 61H 
	OR AL,3					
	OUT PORTB,AL 
		
ENDM


;----------------------------------------------------------------------------------
;<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<  DELAY TIMER  >>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>>
;----------------------------------------------------------------------------------

DELAY_TIMER MACRO VAR 		
	
	LOCAL OUTERLOOP,INNERLOOP
	MOV CX,VAR
		
	OUTERLOOP:
	PUSH CX
		
	MOV CX,0FFFFH
	INNERLOOP: LOOP INNERLOOP
		
	POP CX
	LOOP OUTERLOOP
		
ENDM



.DATA


PROMPT DB "PRESS ANY BUTTON TO PLAY OR",13,10,'$'
EXITPROMPT DB "PRESS CTRL+C TO EXIT.$"
PORTB EQU 61H


KEYBD2 EQU 07H


DOSCALL EQU 21H


CONTC EQU 03H


TABLE DW 262D ;FREQUENCIES IN HERTZ
      DW 294D
      DW 330D
      DW 347D
      
	  DW 392D
	  DW 420D
      DW 440D
	  DW 470D
   
      ; DW 494D
	  ; DW 524D
	  ; DW 550D
	  ; DW 575D
	  
	  ; DW 699D
	  ; DW 630D
	  ; DW 655D
	  ; DW 700D
	  
.CODE

;|*************************************************************************************|
;|-------------------------------------------------------------------------------------|
;|*********************************** MAIN PROC ***************************************|
;|-------------------------------------------------------------------------------------|
;|*************************************************************************************|

MAIN PROC
  
	.STARTUP
	
    MOV AH,9
	LEA DX,PROMPT
	INT 21H
	LEA DX,EXITPROMPT
	INT 21H

	KEYINPUT:
		
	
		MOV AH,KEYBD2  	  ;		CHARACTER INPUT 
		INT DOSCALL   
		
		
		CMP AL,CONTC   	  ;		CHECK FOR EXIT
		JZ EXIT 

		;|**************************************************************|
		;|===================CHARACTER MANUPULATION=====================|
		;|**************************************************************|


		SUB AL, 30H		  ;	  ASCII TO DIGIT (SPECIFIC)
		AND AL, 00000111B ;   MASKING OFF UPPER 3 BITS
		

		SHL AL,1          ;	  MAKING THE NUMBER MULTIPLE OF TWO
		CBW               ;   CONVERT BYTE INTO WORD 
		
		CALL PITCH_GENERATE
		
		;|**************************************************************|
		;|===============COUNTER/TIMER2 INTERUPTION=====================|
		;|**************************STRART******************************|

		MOV AL,182           ;     INTIALIZING SPEAKER FOR NOTE/PITCH
		OUT 43H,AL 			 ;     SENT DATA TO TIMER2
		
		
		MOV AX,BX			 
							 ;     SENDING FREQUENCY TO PORT42/COUNTER PORT
		
		OUT 42H,AL			 ;     LOWER  8-BIT;		
		MOV AL,AH			  		
		OUT 42H,AL			 ;	   HIGHER 8-BIT
		
		COMMAND_SPEAKER_ON   ;     REFFER TO MACRO
		
		
		
		;|***************************END********************************|
		;|===============COUNTER/TIMER2 INTERUPTION=====================|
		;|**************************************************************|

		DELAY_TIMER 08H			;     REFFER TO MACRO WITH TIME INPUT
		
		COMMAND_SPEAKER_OFF		;     REFFER MACRO
		 
		 
		 EXIT:	
		.EXIT

MAIN ENDP


;|*************************************************************************************|
;|-------------------------------------------------------------------------------------|
;|********************************** MAIN PROC END ************************************|
;|-------------------------------------------------------------------------------------|
;|*************************************************************************************|






;|*************************************************************************************|
;|==================================PITCH GENERATING===================================|
;|****************************************START****************************************|


PITCH_GENERATE PROC
PUSH CX
PUSH DX


				
		MOV BX,AX   	   

		MOV DX,18H        ;		32 BITS DIVIDEND
		MOV AX,0           

		DIV [TABLE + BX]  ;		16 BITS DIVISOR
 		
		MOV BX,AX   	  ;		GENERATED 1/PITCH
		

POP DX
POP CX
RET
PITCH_GENERATE ENDP


;|*****************************************END*****************************************|
;|==================================PITCH GENERATING===================================|
;|*************************************************************************************|



END MAIN
